# 数据库设计文档

## fy_info

> **描述**：软件信息表，用于存储软件的各种配置信息，每个键值对表示一条记录。

### 数据列

| 列名        | 数据类型        | 约束                    | 描述                            | 是否为空 | 键约束     | 级联修改 | 级联删除 |
|-------------|--------------|-----------------|---------------------------------|----------|----------|----------|----------|
| id           | char(36)     | PRIMARY KEY     | 主键，全局唯一标识符            | 否       | fy_info_pk |          |           |
| key          | varchar      | NOT NULL        | 键，用于唯一标识信息项            | 否       |            |          |           |
| value        | varchar      | NOT NULL        | 值，存储对应键的具体信息            | 否       |            |          |           |
| updated_at  | timestamp    | DEFAULT now() | 数据更新时间，自动设置为当前时间 | 否       |            |          |           |

### 索引

- **fy_info_key_uindex**: `key` 列的唯一索引，确保每个键的值在整个表中是唯一的

## fy_permission

> **描述**：权限表，用于管理系统的权限分配，每个记录代表一个独立的权限，可以有层级关系。

### 数据列

| 列名        | 数据类型        | 约束                    | 描述                            | 是否为空 | 键约束     | 级联修改 | 级联删除 |
|-------------|--------------|-----------------|---------------------------------|----------|----------|----------|----------|
| pid         | bigserial     | PRIMARY KEY     | 主键，自增，用于唯一标识权限     | 否       | fy_permission_pk |          |           |
| permission  | varchar      | NOT NULL        | 权限字段，用于唯一标识权限名称      | 否       |            |          |           |
| description | varchar      | NOT NULL        | 权限描述，详细说明权限的含义        | 否       |            |          |           |
| parent      | bigint        | FOREIGN KEY     | 父权限，引用 pid 列，表示权限层级 | 是       | fy_permission_pid_fk | cascade | set_null |

### 外键约束

- **fy_permission_fy_permission_pid_fk**: `parent` 列引用 `fy_permission` 表的 `pid` 列，更新时级联，删除时设置为 NULL

### 索引

- **fy_permission_permission_uindex**: `permission` 列的唯一索引，确保每个权限名称在整个表中是唯一的

## fy_role

> **描述**：角色表，用于管理系统的用户角色，每个角色有自己的名称和描述。

### 数据列

| 列名        | 数据类型        | 约束                    | 描述                            | 是否为空 | 键约束     | 级联修改 | 级联删除 |
|-------------|--------------|-----------------|---------------------------------|----------|----------|----------|----------|
| ruuid        | varchar(32)   | PRIMARY KEY     | 主键，用于唯一标识角色           | 否       | fy_role_pk |          |           |
| name         | varchar(30)   | NOT NULL        | 角色名字，用于区分不同的角色       | 否       |            |          |           |
| display_name | varchar(30)   | NOT NULL        | 展示名字，用于用户界面的显示       | 否       |            |          |           |
| description  | varchar      | NOT NULL        | 角色描述，详细说明角色的权限和功能 | 否       |            |          |           |
| updated_at   | timestamp    | DEFAULT now() | 更新时间，自动设置为当前时间     | 否       |            |          |           |

### 索引

- **fy_role_role_uindex**: `name` 列的唯一索引，确保每个角色名称在整个表中是唯一的

## fy_vip

> **描述**：付费会员表，用于管理付费用户的不同会员等级。

### 数据列

| 列名        | 数据类型        | 约束                    | 描述                            | 是否为空 | 键约束     | 级联修改 | 级联删除 |
|-------------|--------------|-----------------|---------------------------------|----------|----------|----------|----------|
| vuuid        | varchar(32)   | PRIMARY KEY     | 主键，用于唯一标识会员           | 否       | fy_vip_pk |          |           |
| name         | varchar(30)   | NOT NULL        | 会员名称，用于区分不同的会员等级   | 否       |            |          |           |
| display_name | varchar(30)   | NOT NULL        | 展示名字，用于用户界面的显示       | 否       |            |          |           |
| description  | varchar      | NOT NULL        | 会员描述，详细说明会员的权益和特点 | 否       |            |          |           |
| updated_at   | timestamp    | DEFAULT now() | 更新时间，自动设置为当前时间     | 否       |            |          |           |

### 索引

- **fy_vip_name_uindex**: `name` 列的唯一索引，确保每个会员名称在整个表中是唯一的

## fy_user

> **描述**：用户表，存储用户的基本信息、联系信息、角色和付费会员状态。

### 数据列

| 列名              | 数据类型        | 约束                    | 描述                            | 是否为空 | 键约束     | 级联修改 | 级联删除 |
|-------------|--------------|-----------------|---------------------------------|----------|----------|----------|----------|
| uuid             | varchar(32)   | PRIMARY KEY     | 用户主键，用于唯一标识用户       | 否       | fy_user_pk |          |           |
| username          | varchar(40)   | NOT NULL        | 用户名，用于登录和识别用户       | 否       |            |          |           |
| email             | varchar(100) | NOT NULL        | 邮箱，用于用户联系和验证           | 否       |            |          |           |
| phone             | varchar(11)    | NOT NULL        | 手机号码，用于用户联系和验证     | 否       |            |          |           |
| password          | varchar(60)   | NOT NULL        | 密码，用于用户身份验证           | 否       |            |          |           |
| old_password      | varchar(60)   |                | 旧密码，用于密码重置             | 是       |            |          |           |
| avatar            | varchar(64)   |                | 头像（非地址），用户个人资料图片   | 是       |            |          |           |
| otp_auth          | varchar(32)   | NOT NULL        | 2FA-OTPAuth，用于二次验证           | 否       |            |          |           |
| mail_verify       | boolean       | DEFAULT false   | 邮箱验证状态，是否已验证           | 否       |            |          |           |
| phone_verify      | boolean       | DEFAULT false   | 手机验证状态，是否已验证         | 否       |            |          |           |
| basic_information | json         | NOT NULL        | 基础信息，可能包含用户扩展数据     | 否       |            |          |           |
| role              | integer       | FOREIGN KEY   | 用户角色，引用 fy_role 表的 ruuid | 否       | fy_user_fy_role_ruuid_fk | cascade  | set_null  |
| vip               | varchar(32)   | FOREIGN KEY    | 付费会员，引用 fy_vip 表的 vuuid | 是       | fy_user_fy_vip_vuuid_fk | cascade  | set_null   |
| created_at        | timestamp    | DEFAULT now() | 创建时间，自动设置为当前时间     | 否       |            |          |           |
| updated_at        | timestamp    |                | 修改时间，可能为空               | 是       |            |          |           |

### 外键约束

- **fy_user_fy_role_ruuid_fk**: `role` 列引用 `fy_role` 表的 `ruuid` 列，更新时级联，删除时设置为 NULL
- **fy_user_fy_vip_vuuid_fk**: `vip` 列引用 `fy_vip` 表的 `vuuid` 列，更新时级联，删除时设置为 NULL

### 索引

- **fy_user_email_uindex**: `email` 列的唯一索引
- **fy_user_otp_auth_uindex**: `otp_auth` 列的唯一索引
- **fy_user_phone_uindex**: `phone` 列的唯一索引
- **fy_user_username_uindex**: `username` 列的唯一索引

### 数据结构

#### basic_information

```json
{
    userQQ: "1144939537",
    userWechat: "xiao_lfeng",
    [等待完善]......
}
```